<!doctype html>
<html lang="ru">
    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>Курс валют - Калужская сбытовая компания</title>
        <link rel="shortcut icon" href="favicon.ico" type="image/x-icon">
        <link rel="icon" href="favicon-16x16.png">
        <link rel="icon" href="favicon-32x32.png">
        <link rel="manifest" href="/site.webmanifest">
        <link rel="mask-icon" href="/safari-pinned-tab.svg" color="#0061af">
        <meta name="msapplication-TileColor" content="#0061af">
        <meta name="theme-color" content="#ffffff">
        
        <style>
            :root {
                --primary-blue: #0061AF;
                --primary-red: #E30613;
                --dark-gray: #1A1A1A;
                --light-gray: #F5F5F5;
                --text-color: #333333;
            }
            
            body {
                font-family: 'Roboto', Arial, sans-serif;
                margin: 0;
                padding: 0;
                color: var(--text-color);
                line-height: 1.6;
            }
            
            .header {
                background-color: white;
                box-shadow: 0 2px 10px rgba(0,0,0,0.1);
                position: sticky;
                top: 0;
                z-index: 100;
                padding: 15px 20px;
            }
            
            .header-container {
                display: flex;
                justify-content: center;
                max-width: 1200px;
                margin: 0 auto;
            }
            
            .logo {
                width: 180px;
            }
            
            .logo svg {
                width: 100%;
                height: auto;
            }
            
            .main-menu {
                position: fixed;
                right: 0;
                top: 0;
                height: 100vh;
                width: 200px;
                background-color: white;
                box-shadow: -2px 0 10px rgba(0,0,0,0.1);
                display: flex;
                flex-direction: column;
                padding: 100px 20px 20px;
                box-sizing: border-box;
                z-index: 99;
            }
            
            .main-menu a {
                color: var(--dark-gray);
                text-decoration: none;
                font-weight: 500;
                font-size: 16px;
                transition: color 0.3s;
                padding: 10px 0;
                border-bottom: 1px solid #eee;
            }
            
            .main-menu a:hover {
                color: var(--primary-blue);
            }
            
            .main-menu a.active {
                color: var(--primary-blue);
                font-weight: 700;
            }
            
            .container {
                max-width: 1200px;
                margin: 0 auto;
                padding: 40px 20px;
                padding-right: 220px; /* Добавляем отступ для меню */
            }
            
            h1, h2, h3 {
                color: var(--primary-blue);
            }
            
            h1 {
                font-size: 36px;
                margin-bottom: 30px;
            }
            
            .calculator {
                background: white;
                padding: 30px;
                border-radius: 5px;
                box-shadow: 0 3px 10px rgba(0,0,0,0.1);
                margin-bottom: 40px;
            }
            
            .calculator-title {
                margin-top: 0;
                color: var(--primary-blue);
            }
            
            .converter {
                display: flex;
                align-items: center;
                gap: 15px;
                margin-bottom: 20px;
                flex-wrap: wrap;
            }
            
            .converter input {
                padding: 12px 15px;
                border: 1px solid #ddd;
                border-radius: 4px;
                font-size: 16px;
                width: 150px;
            }
            
            .converter select {
                padding: 12px 15px;
                border: 1px solid #ddd;
                border-radius: 4px;
                font-size: 16px;
                background-color: white;
            }
            
            .switch-btn {
                background: var(--primary-blue);
                color: white;
                border: none;
                padding: 12px 15px;
                border-radius: 4px;
                cursor: pointer;
                font-size: 16px;
                transition: background-color 0.3s;
            }
            
            .switch-btn:hover {
                background: #004080;
            }
            
            .calculate-btn {
                background: var(--primary-red);
                color: white;
                border: none;
                padding: 12px 25px;
                border-radius: 4px;
                cursor: pointer;
                font-size: 16px;
                font-weight: 500;
                transition: background-color 0.3s;
                margin-top: 10px;
            }
            
            .calculate-btn:hover {
                background: #c00511;
            }
            
            .result {
                font-size: 18px;
                font-weight: bold;
                margin-top: 20px;
                padding: 15px;
                background: #f0f7ff;
                border-radius: 4px;
                display: none;
            }
            
            .current-rate {
                margin-bottom: 20px;
                font-size: 16px;
            }
            
            .current-rate span {
                font-weight: bold;
                color: var(--primary-blue);
            }
            
            .chart-container {
                background: white;
                padding: 30px;
                border-radius: 5px;
                box-shadow: 0 3px 10px rgba(0,0,0,0.1);
            }
            
            .chart-title {
                margin-top: 0;
                color: var(--primary-blue);
            }
            
            .chart {
                height: 400px;
                margin-top: 30px;
                position: relative;
                display: flex;
                align-items: flex-end;
                justify-content: space-between;
            }
            
            .bar-container {
                display: flex;
                flex-direction: column;
                align-items: center;
                flex: 1;
                max-width: 40px;
                margin: 0 5px;
            }
            
            .bar {
                width: 30px;
                background: var(--primary-blue);
                border-radius: 3px 3px 0 0;
                cursor: pointer;
                transition: background-color 0.3s;
                position: relative;
            }
            
            .bar:hover {
                background: #004080;
            }
            
            .bar.active {
                background: var(--primary-red);
            }
            
            .bar-label {
                margin-top: 10px;
                font-size: 12px;
                text-align: center;
                word-break: break-all;
                max-width: 100%;
            }
            
            .chart-info {
                margin-top: 30px;
                padding: 15px;
                background: #f0f7ff;
                border-radius: 4px;
                display: none;
            }
            
            .loading {
                text-align: center;
                padding: 30px;
                font-size: 18px;
            }
            
            .footer {
                background-color: var(--dark-gray);
                color: white;
                padding: 40px 0;
            }
            
            .footer-container {
                max-width: 1200px;
                margin: 0 auto;
                padding: 0 20px;
                display: grid;
                grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
                gap: 30px;
            }
            
            .footer-column h3 {
                color: white;
                margin-top: 0;
            }
            
            .footer-column a {
                color: #ccc;
                text-decoration: none;
                display: block;
                margin-bottom: 10px;
            }
            
            .footer-column a:hover {
                color: white;
            }
            
            .copyright {
                text-align: center;
                margin-top: 40px;
                padding-top: 20px;
                border-top: 1px solid #444;
            }
            
            .back-to-top {
                position: fixed;
                bottom: 30px;
                right: 30px;
                background-color: var(--primary-blue);
                color: white;
                width: 50px;
                height: 50px;
                border-radius: 50%;
                display: flex;
                justify-content: center;
                align-items: center;
                text-decoration: none;
                font-size: 24px;
                box-shadow: 0 2px 10px rgba(0,0,0,0.2);
                z-index: 99;
            }
            
            @media (max-width: 768px) {
                .converter {
                    flex-direction: column;
                    align-items: flex-start;
                }
                
                .chart {
                    height: 300px;
                    flex-wrap: wrap;
                    justify-content: center;
                }
                
                .bar-container {
                    margin: 0 3px;
                    max-width: 30px;
                }
                
                .bar {
                    width: 20px;
                }
            }
        </style>
        <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;500;700&display=swap" rel="stylesheet">
    </head>
    <body>
        <header class="header">
            <div class="header-container">
                <div class="logo">
                    <img src="logo.svg" alt="Калужская сбытовая компания">
                </div>
            </div>
        </header>
        
        <!-- Фиксированное меню справа -->
        <nav class="main-menu">
            <a href="index.html">О компании</a>
            <a href="news.html">Новости</a>
            <a href="currency.html" class="active">Курс валют</a>
            <a href="contacts.html">Контакты</a>
            <a href="video.html">Видео</a>
        </nav>
        
        <main>
            <div class="container">
                <h1>Курс валют</h1>
                
                <div class="calculator">
                    <h2 class="calculator-title">Калькулятор валют</h2>
                    <div class="current-rate">
                        Текущий курс Бразильского реала (BRL) к рублю (RUB): <span id="currentRateValue">загрузка...</span>
                        <div id="rateDate" style="font-size: 14px; color: #666; margin-top: 5px;"></div>
                    </div>
                    
                    <div class="converter">
                        <input type="number" id="amount" value="100" min="0" step="0.01">
                        <select id="fromCurrency">
                            <option value="RUB">RUB (Рубли)</option>
                            <option value="BRL">BRL (Реалы)</option>
                        </select>
                        <span>→</span>
                        <select id="toCurrency">
                            <option value="BRL">BRL (Реалы)</option>
                            <option value="RUB">RUB (Рубли)</option>
                        </select>
                        <button class="switch-btn" id="switchCurrencies">↔ Поменять</button>
                    </div>
                    
                    <button class="calculate-btn" id="calculate">Рассчитать</button>
                    
                    <div class="result" id="result"></div>
                </div>
                
                <div class="chart-container">
                    <h2 class="chart-title">Динамика курса BRL/RUB за последний месяц</h2>
                    <div class="loading" id="chartLoading">Загрузка данных о курсах валют...</div>
                    <div class="chart" id="chart"></div>
                    <div class="chart-info" id="chartInfo"></div>
                </div>
            </div>
        </main>

        <footer class="footer">
            <div class="footer-container">
                <div class="footer-column">
                    <h3>О компании</h3>
                    <a href="#">Руководство</a>
                    <a href="#">Лицензии</a>
                    <a href="#">Реквизиты</a>
                    <a href="#">Документы</a>
                </div>
                <div class="footer-column">
                    <h3>Потребителям</h3>
                    <a href="#">Физическим лицам</a>
                    <a href="#">Юридическим лицам</a>
                    <a href="#">Тарифы</a>
                    <a href="#">Энергосбережение</a>
                </div>
                <div class="footer-column">
                    <h3>Контакты</h3>
                    <p>248016, г. Калуга, ул. Вишневского, 1</p>
                    <p>+7 (4842) 57-97-70</p>
                    <p>info@kskkaluga.ru</p>
                </div>
                <div class="footer-column">
                    <h3>Оплата</h3>
                    <a href="#">Способы оплаты</a>
                    <a href="#">Офисы и терминалы</a>
                    <a href="#">Онлайн-оплата</a>
                </div>
            </div>
            <div class="copyright">
                © ПАО «Калужская сбытовая компания», 2006—2025. Все права защищены.
            </div>
        </footer>
        
        <a href="#" class="back-to-top">↑</a>
        
        <script>
            document.addEventListener('DOMContentLoaded', function() {
                // Элементы интерфейса
                const amountInput = document.getElementById('amount');
                const fromCurrencySelect = document.getElementById('fromCurrency');
                const toCurrencySelect = document.getElementById('toCurrency');
                const switchBtn = document.getElementById('switchCurrencies');
                const calculateBtn = document.getElementById('calculate');
                const resultDiv = document.getElementById('result');
                const currentRateValue = document.getElementById('currentRateValue');
                const rateDate = document.getElementById('rateDate');
                const chart = document.getElementById('chart');
                const chartInfo = document.getElementById('chartInfo');
                const chartLoading = document.getElementById('chartLoading');
                
                // Текущий курс BRL
                let currentRate = 0;
                let historicalRates = [];
                
                // Загрузка текущего курса
                function loadCurrentRate() {
                    fetch('https://www.cbr-xml-daily.ru/daily_json.js')
                        .then(response => response.json())
                        .then(data => {
                            const brlRate = data.Valute.BRL.Value / data.Valute.BRL.Nominal;
                            currentRate = brlRate;
                            currentRateValue.textContent = brlRate.toFixed(4) + ' RUB';
                            
                            // Форматируем дату
                            const date = new Date(data.Date);
                            const options = { day: 'numeric', month: 'long', year: 'numeric' };
                            rateDate.textContent = 'по состоянию на ' + date.toLocaleDateString('ru-RU', options);
                            
                            // Загружаем исторические данные после получения текущего курса
                            loadHistoricalRates();
                        })
                        .catch(error => {
                            console.error('Ошибка загрузки курса:', error);
                            currentRateValue.textContent = 'не удалось загрузить';
                        });
                }
                
                // Загрузка исторических данных за последние 30 дней
                function loadHistoricalRates() {
                    const endDate = new Date();
                    const startDate = new Date();
                    startDate.setDate(endDate.getDate() - 30);
                    
                    const formatDate = (date) => {
                        const year = date.getFullYear();
                        const month = String(date.getMonth() + 1).padStart(2, '0');
                        const day = String(date.getDate()).padStart(2, '0');
                        return `${year}/${month}/${day}`;
                    };
                    
                    const url = `https://www.cbr-xml-daily.ru/archive/${formatDate(startDate)}/${formatDate(endDate)}/daily_json.js`;
                    
                    fetch(url)
                        .then(response => response.json())
                        .then(data => {
                            // Преобразуем объект в массив и фильтруем только нужные даты
                            historicalRates = Object.entries(data)
                                .map(([date, rates]) => ({
                                    date: new Date(date),
                                    rate: rates.Valute.BRL.Value / rates.Valute.BRL.Nominal
                                }))
                                .sort((a, b) => a.date - b.date);
                            
                            renderChart();
                        })
                        .catch(error => {
                            console.error('Ошибка загрузки исторических данных:', error);
                            chartLoading.textContent = 'Не удалось загрузить исторические данные';
                        });
                }
                
                // Отрисовка графика
                function renderChart() {
                    chartLoading.style.display = 'none';
                    chart.innerHTML = '';
                    
                    if (!historicalRates.length) {
                        chart.innerHTML = '<p>Нет данных для отображения</p>';
                        return;
                    }
                    
                    // Находим минимальное и максимальное значение курса для масштабирования
                    const minRate = Math.min(...historicalRates.map(item => item.rate));
                    const maxRate = Math.max(...historicalRates.map(item => item.rate));
                    const range = maxRate - minRate;
                    
                    historicalRates.forEach((item, index) => {
                        const barContainer = document.createElement('div');
                        barContainer.className = 'bar-container';
                        
                        const barHeight = range ? ((item.rate - minRate) / range * 350) : 175;
                        const bar = document.createElement('div');
                        bar.className = 'bar';
                        bar.style.height = `${barHeight}px`;
                        bar.dataset.date = item.date.toLocaleDateString('ru-RU');
                        bar.dataset.rate = item.rate.toFixed(4);
                        
                        bar.addEventListener('click', function() {
                            // Удаляем активный класс у всех столбцов
                            document.querySelectorAll('.bar').forEach(b => b.classList.remove('active'));
                            
                            // Добавляем активный класс к текущему столбцу
                            this.classList.add('active');
                            
                            // Показываем информацию о курсе
                            chartInfo.style.display = 'block';
                            chartInfo.innerHTML = `
                                <strong>Дата:</strong> ${this.dataset.date}<br>
                                <strong>Курс:</strong> 1 BRL = ${this.dataset.rate} RUB
                            `;
                        });
                        
                        const label = document.createElement('div');
                        label.className = 'bar-label';
                        label.textContent = item.date.toLocaleDateString('ru-RU', { day: 'numeric', month: 'short' });
                        
                        barContainer.appendChild(bar);
                        barContainer.appendChild(label);
                        chart.appendChild(barContainer);
                    });
                }
                
                // Переключение валют
                switchBtn.addEventListener('click', function() {
                    const fromValue = fromCurrencySelect.value;
                    fromCurrencySelect.value = toCurrencySelect.value;
                    toCurrencySelect.value = fromValue;
                });
                
                // Расчет конвертации
                calculateBtn.addEventListener('click', function() {
                    if (!currentRate) {
                        resultDiv.textContent = 'Курс не загружен, попробуйте позже';
                        resultDiv.style.display = 'block';
                        return;
                    }
                    
                    const amount = parseFloat(amountInput.value);
                    if (isNaN(amount)) {
                        resultDiv.textContent = 'Введите корректную сумму';
                        resultDiv.style.display = 'block';
                        return;
                    }
                    
                    let result;
                    if (fromCurrencySelect.value === 'RUB' && toCurrencySelect.value === 'BRL') {
                        result = amount / currentRate;
                        resultDiv.innerHTML = `<strong>${amount.toFixed(2)} RUB</strong> = <strong>${result.toFixed(4)} BRL</strong>`;
                    } else if (fromCurrencySelect.value === 'BRL' && toCurrencySelect.value === 'RUB') {
                        result = amount * currentRate;
                        resultDiv.innerHTML = `<strong>${amount.toFixed(2)} BRL</strong> = <strong>${result.toFixed(2)} RUB</strong>`;
                    } else {
                        resultDiv.textContent = 'Выберите разные валюты';
                    }
                    
                    resultDiv.style.display = 'block';
                });
                
                // Кнопка "Наверх"
                document.querySelector('.back-to-top').addEventListener('click', function(e) {
                    e.preventDefault();
                    window.scrollTo({top: 0, behavior: 'smooth'});
                });
                
                // Загружаем текущий курс при загрузке страницы
                loadCurrentRate();
            });
        </script>
    </body>
</html>